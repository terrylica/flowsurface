# Development tasks for flowsurface

[build]
description = "Build debug binary"
run = "cargo build"

["build:release"]
description = "Build optimized release binary for current platform"
run = "cargo build --release"

[run]
description = "Build and run flowsurface with ClickHouse range bar support"
depends = ["preflight"]
run = "cargo run"

["run:app"]
description = "Launch Flowsurface.app bundle (pre-built binary, dock icon)"
depends = ["preflight"]
run = """
kill -9 $(pgrep -f "flowsurface.bin") 2>/dev/null || true
sleep 0.5
open Flowsurface.app
"""

[check]
description = "Run cargo check (fast type-check without codegen)"
run = "cargo check --workspace"

[clippy]
description = "Run clippy lints across all workspace crates"
run = "cargo clippy --all-targets -- -D warnings"

[fmt]
description = "Format all Rust code"
run = "cargo fmt --all"

["fmt:check"]
description = "Check Rust formatting without modifying files"
run = "cargo fmt --all -- --check"

[lint]
description = "Run format check + clippy (matches CI)"
depends = ["fmt:check", "clippy"]

["widget:validate"]
description = "Validate widget code and run app to test floating BTC widget"
run = """
echo "→ Checking widget module..."
cargo check --bin flowsurface -p flowsurface 2>&1 | grep -E "error|widget" || echo "✓ Widget code checks out"

echo "→ Building release for widget testing..."
cargo build --release 2>&1 | tail -3

echo "→ Launching app with widget support..."
kill -9 $(pgrep -f "flowsurface.bin") 2>/dev/null || true
sleep 0.5
cp target/release/flowsurface Flowsurface.app/Contents/MacOS/flowsurface.bin
open Flowsurface.app

echo ""
echo "✓ Widget validation complete. Launch widget via:"
echo "  1. App menu → Show BTC Widget"
echo "  2. Click and drag anywhere on the widget to move it"
echo "  3. Watch price and range bars update in real-time from WebSocket trades"
"""
